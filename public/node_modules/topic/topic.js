(function(){
    var app = angular.module('topic', ['form-comment']);

    function findNameInVotedFrom(input,toFind)
    {
        for(var i = 0; i < input.length; i++)
        {
            if(input[i].user==toFind)
            {
                return i;
            }
        }
        return -1;
    }
    
    app.directive('topic', function(){
        return {
            restrict: 'E',
            templateUrl: 'node_modules/topic/topic.html',
            controller: function(){
                this.topic = Topic;
                this.addLike = function(){

                    var like = findNameInVotedFrom(this.topic.like,'blablabla');
                    var dislike = findNameInVotedFrom(this.topic.dislike,'blablabla');
                    if(like==-1)
                    {
                        if(dislike!=-1)
                            this.topic.dislike.splice(dislike,1); 
                        this.topic.like.push({user:'blablabla'});
                    }
                    else
                        this.topic.like.splice(like,1);
                };
                this.addDislike = function(){        
                    
                    var like = findNameInVotedFrom(this.topic.like,'blablabla');
                    var dislike = findNameInVotedFrom(this.topic.dislike,'blablabla');
                    if(dislike==-1)
                    {
                        if(like!=-1)
                            this.topic.like.splice(like,1);
                        this.topic.dislike.push({user:'blablabla'});
                    }
                    else
                        this.topic.dislike.splice(dislike,1);
                };
            },
            controllerAs: 't'
        };
    });
        
    var Topic = {
        title: "Primo topic",
        subtitle: "Sottotitolo del primo topic",
        text: "Testo del primo topic",
        author: "Mattia Buffa",
        createdOn: 1397490980837,
        comments: [
            {
                text: "Primo commento del topic 1",
                author: "Qualcuno",
                createdOn: 1397490980837
            },
            {
                text: "Secondo commento del topic 1",
                author: "Qualcuno2",
                createdOn: 1397590981837
            }
                  ],
        like: [{user: "Qualcuno"},{user: "Qualcuno2"}],
        dislike: [{user: "Qualcuno1"},{user: "Qualcuno3"}]
    };
    
})();